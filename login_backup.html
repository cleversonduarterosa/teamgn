<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrar - Team GN</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --verde-neon: #00FF41;
            --fundo-principal: #0A1A0F;
            --fundo-card: #0D2818;
            --fundo-input: #122E1C;
            --texto-principal: #E6EDF3;
            --texto-secundario: #8B949E;
            --borda: #1E4D2B;
            --erro: #F85149;
            --sucesso: #3FB950;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--fundo-principal);
            color: var(--texto-principal);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(0, 255, 65, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(46, 125, 50, 0.05) 0%, transparent 40%);
            pointer-events: none;
        }
        .container { width: 100%; max-width: 420px; position: relative; z-index: 1; }
        .back-link { display: block; text-align: center; color: var(--verde-neon); text-decoration: none; margin-bottom: 20px; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }
        .card {
            background: var(--fundo-card);
            border: 1px solid var(--borda);
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .header { text-align: center; margin-bottom: 30px; }
        .logo { display: inline-flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .logo-img { width: 50px; height: 50px; border-radius: 50%; }
        .logo-text .nome { font-family: 'Montserrat'; font-size: 1.1rem; font-weight: 900; color: var(--verde-neon); letter-spacing: 2px; }
        .logo-text .subtitulo { font-size: 0.65rem; color: var(--texto-secundario); }
        .title { font-family: 'Montserrat'; font-size: 1.5rem; font-weight: 800; margin-bottom: 8px; }
        .subtitle { color: var(--texto-secundario); font-size: 0.9rem; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--texto-secundario); margin-bottom: 8px; text-transform: uppercase; }
        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--fundo-input);
            border: 1px solid var(--borda);
            border-radius: 8px;
            color: var(--texto-principal);
            font-size: 1rem;
            transition: all 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--verde-neon); box-shadow: 0 0 0 3px rgba(0, 255, 65, 0.1); }
        .password-wrapper {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--texto-secundario);
            transition: color 0.3s;
            user-select: none;
        }
        .password-toggle:hover {
            color: var(--verde-neon);
        }
        .form-options { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; font-size: 0.85rem; }
        .checkbox-group { display: flex; align-items: center; gap: 8px; }
        .checkbox-group input { accent-color: var(--verde-neon); }
        .forgot-link { color: var(--verde-neon); text-decoration: none; }
        .forgot-link:hover { text-decoration: underline; }
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-family: 'Montserrat';
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: var(--verde-neon);
            color: #000;
        }
        .btn:hover { box-shadow: 0 0 30px rgba(0, 255, 65, 0.4); transform: translateY(-2px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .login-footer { text-align: center; margin-top: 25px; }
        .login-footer p { color: var(--texto-secundario); font-size: 0.9rem; }
        .login-footer a { color: var(--verde-neon); font-weight: 600; text-decoration: none; }
        .alert { padding: 12px 16px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; display: none; }
        .alert.show { display: block; }
        .alert-error { background: rgba(248, 81, 73, 0.1); border: 1px solid var(--erro); color: var(--erro); }
        .alert-success { background: rgba(63, 185, 80, 0.1); border: 1px solid var(--sucesso); color: var(--sucesso); }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Voltar ao site</a>
        
        <div class="card">
            <div class="header">
                <div class="logo">
                    <img src="logo.png" alt="Team GN" class="logo-img">
                    <div class="logo-text">
                        <div class="nome">TEAM GN</div>
                        <div class="subtitulo">Sa√∫de & Performance</div>
                    </div>
                </div>
                <h1 class="title">Bem-vindo de volta!</h1>
                <p class="subtitle">Entre na sua conta para continuar</p>
            </div>
            
            <div id="alert-error" class="alert alert-error"></div>
            <div id="alert-success" class="alert alert-success"></div>
            
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label">E-mail</label>
                    <input type="email" id="email" class="form-input" placeholder="seu@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <div class="password-wrapper">
                        <input type="password" id="senha" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        <span class="password-toggle" id="toggle-senha" onclick="togglePassword()">üëÅÔ∏è</span>
                    </div>
                </div>
                
                <div class="form-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="lembrar">
                        <label for="lembrar">Lembrar de mim</label>
                    </div>
                    <a href="recuperar-senha.html" class="forgot-link">Esqueci a senha</a>
                </div>
                
                <button type="submit" id="btn-login" class="btn">ENTRAR</button>
            </form>
            
            <div class="login-footer">
                <p>Para participar, entre em <a href="contato.html">contato</a> com a equipe <br><span style="color: var(--verde-neon); font-size: 0.7rem; margin-top: 10px; display: inline-block;">v1.09</span></p>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Fun√ß√£o para mostrar/ocultar senha
        function togglePassword() {
            var senhaInput = document.getElementById('senha');
            var toggleIcon = document.getElementById('toggle-senha');
            
            if (senhaInput.type === 'password') {
                senhaInput.type = 'text';
                toggleIcon.textContent = 'üôà';
            } else {
                senhaInput.type = 'password';
                toggleIcon.textContent = 'üëÅÔ∏è';
            }
        }
        
        (function() {
            // Configura√ß√£o
            var SUPABASE_URL = 'https://nofgmwjaqeovrsdxzfib.supabase.co';
            var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vZmdtd2phcWVvdnJzZHh6ZmliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NTE2ODMsImV4cCI6MjA4MzAyNzY4M30.y1Iem-Qk-gIjwiK1jyzbZgdUAe7934pGg3hsjGB0-5U';
            
            // Cliente Supabase
            var db = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase conectado!');
            
            // Elementos
            var form = document.getElementById('login-form');
            var btnLogin = document.getElementById('btn-login');
            var alertError = document.getElementById('alert-error');
            var alertSuccess = document.getElementById('alert-success');
            
            // Submit do form
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                fazerLogin();
            });
            
            async function fazerLogin() {
                var email = document.getElementById('email').value;
                var senha = document.getElementById('senha').value;
                
                // Limpar alertas
                alertError.classList.remove('show');
                alertSuccess.classList.remove('show');
                
                // Desabilitar bot√£o
                btnLogin.disabled = true;
                btnLogin.textContent = 'Entrando...';
                
                try {
                    console.log('=== INICIANDO LOGIN ===');
                    console.log('Email:', email);
                    
                    // Login
                    var resultado = await db.auth.signInWithPassword({
                        email: email,
                        password: senha
                    });
                    
                    if (resultado.error) {
                        throw resultado.error;
                    }
                    
                    console.log('‚úì Autentica√ß√£o OK!');
                    console.log('User ID:', resultado.data.user.id);
                    console.log('User Email:', resultado.data.user.email);
                    
                    // Sucesso
                    alertSuccess.textContent = 'Login realizado com sucesso! Redirecionando...';
                    alertSuccess.classList.add('show');
                    
                    // Buscar perfil COM MAIS LOGS
                    console.log('=== BUSCANDO PERFIL NA TABELA ===');
                    var perfilResult = await db
                        .from('perfis')
                        .select('id, papel, nome_completo, email')
                        .eq('id', resultado.data.user.id)
                        .single();
                    
                    console.log('Resultado da consulta perfis:');
                    console.log('- Error:', perfilResult.error);
                    console.log('- Data:', perfilResult.data);
                    
                    if (perfilResult.error) {
                        console.error('ERRO ao buscar perfil:', perfilResult.error);
                        throw new Error('Perfil n√£o encontrado no banco de dados');
                    }
                    
                    if (!perfilResult.data) {
                        console.error('PERFIL VAZIO! Usu√°rio sem registro na tabela perfis');
                        throw new Error('Perfil n√£o cadastrado');
                    }
                    
                    var papel = perfilResult.data.papel;
                    console.log('=== PAPEL DO USU√ÅRIO ===');
                    console.log('Papel encontrado:', papel);
                    console.log('Tipo:', typeof papel);
                    console.log('√â admin?', papel === 'admin');
                    
                    // Redirecionar baseado no papel
                    setTimeout(function() {
                        if (papel === 'admin') {
                            console.log('‚Üí Redirecionando para ADMIN DASHBOARD');
                            window.location.href = 'admin-dashboard.html';
                        } else {
                            console.log('‚Üí Redirecionando para PAINEL ATLETA');
                            window.location.href = 'painel-atleta.html';
                        }
                    }, 1500);
                    
                } catch (erro) {
                    console.error('Erro:', erro);
                    
                    var msg = 'Erro ao fazer login';
                    if (erro.message) {
                        if (erro.message.indexOf('Invalid login') >= 0) {
                            msg = 'E-mail ou senha incorretos';
                        } else if (erro.message.indexOf('Email not confirmed') >= 0) {
                            msg = 'E-mail n√£o confirmado';
                        } else {
                            msg = erro.message;
                        }
                    }
                    
                    alertError.textContent = msg;
                    alertError.classList.add('show');
                    
                    btnLogin.disabled = false;
                    btnLogin.textContent = 'ENTRAR';
                }
            }
        })();
    </script>
</body>
</html>
